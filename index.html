<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Planning Sports Complet</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/main.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/main.min.js"></script>
  <style>
    .team-logo { width: 30px; height: 30px; object-fit: contain; }
    .vs { font-weight: bold; font-size: 1.2rem; margin: 0 10px; }
    #calendar { max-width: 900px; margin: 2rem auto; }
  </style>
</head>
<body class="bg-light">
<div class="container py-4">
  <h1 class="text-center mb-4">ğŸ… Planning Multi-Sport</h1>

  <div class="row mb-3">
    <div class="col-md-4">
      <label class="form-label">ğŸ† CompÃ©tition</label>
      <select id="competitionSelect" class="form-select">
        <option value="all">Toutes</option>
        <option value="Ligue 1">Ligue 1</option>
        <option value="MotoGP">MotoGP</option>
        <option value="F1">Formule 1</option>
        <!-- autres compÃ©titions... -->
      </select>
    </div>
    <div class="col-md-4">
      <label class="form-label">ğŸ“… Date</label>
      <input type="date" id="dateSelect" class="form-control">
    </div>
    <div class="col-md-4">
      <label class="form-label">ğŸŒ Zone</label>
      <select id="regionSelect" class="form-select">
        <option value="all">Toutes</option>
        <option value="Europe">Europe</option>
        <option value="AmÃ©rique">AmÃ©rique</option>
      </select>
    </div>
  </div>

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5>ğŸ“† Vue Calendrier</h5>
    <button class="btn btn-outline-primary" onclick="loadCalendar()">Afficher</button>
  </div>

  <div id="match-list" class="row g-4"></div>

  <div id="calendar"></div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBToR5BXaPHsg8GgMosJBMompqUU1LBGG8",
    authDomain: "planning-sports.firebaseapp.com",
    projectId: "planning-sports",
    storageBucket: "planning-sports.appspot.com",
    messagingSenderId: "808656601330",
    appId: "1:808656601330:web:02c6c6c54e4cc705d6d06b"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  async function fetchMatches() {
    const comp = document.getElementById("competitionSelect").value;
    const region = document.getElementById("regionSelect").value;
    const date = document.getElementById("dateSelect").value;
    
    const ref = collection(db, "matches");
    const snapshot = await getDocs(ref);
    const matches = [];

    snapshot.forEach(doc => {
      const data = doc.data();
      if ((comp === 'all' || data.competition === comp) &&
          (region === 'all' || data.region === region) &&
          (!date || data.date === date)) {
        matches.push(data);
      }
    });

    renderMatches(matches);
    return matches;
  }

  function renderMatches(matches) {
    const matchList = document.getElementById("match-list");
    matchList.innerHTML = matches.map(match => `
      <div class="col-md-6">
        <div class="card p-3 shadow-sm">
          <h6 class="text-muted">${match.competition} â€” ${match.date}</h6>
          <div class="d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center">
              <img src="${match.home.logo}" class="team-logo me-2" alt="${match.home.name}">
              <span>${match.home.name}</span>
            </div>
            <div class="vs">${match.score || "vs"}</div>
            <div class="d-flex align-items-center">
              <span>${match.away.name}</span>
              <img src="${match.away.logo}" class="team-logo ms-2" alt="${match.away.name}">
            </div>
          </div>
          <p class="mb-0 mt-2">Heure : ${match.time}</p>
          ${match.channel ? `<a href="${match.paid ? match.streaming : '#'}" target="_blank" class="btn btn-sm mt-2 ${match.paid ? 'btn-danger' : 'btn-success'}">ğŸ“º ${match.channel}</a>` : ''}
        </div>
      </div>
    `).join('');
  }

  async function loadCalendar() {
    const matches = await fetchMatches();
    const calendarEl = document.getElementById("calendar");
    calendarEl.innerHTML = "";

    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      locale: 'fr',
      events: matches.map(m => ({
        title: `${m.home.name} vs ${m.away.name}`,
        start: `${m.date}T${m.time}:00`,
        url: m.streaming || null
      }))
    });
    calendar.render();
  }

  document.getElementById("competitionSelect").addEventListener("change", fetchMatches);
  document.getElementById("regionSelect").addEventListener("change", fetchMatches);
  document.getElementById("dateSelect").addEventListener("change", fetchMatches);

  fetchMatches();
</script>
</body>
</html>





